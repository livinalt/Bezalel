{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/bridge/Bezalel/bezalel/src/components/Canvas.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef, useImperativeHandle, forwardRef } from \"react\";\r\nimport {\r\n    Canvas as FabricJSCanvas,\r\n    PencilBrush,\r\n    Pattern,\r\n    Path,\r\n} from \"fabric\";\r\n\r\ninterface CanvasProps {\r\n    isDrawingMode: boolean;\r\n    setCanvasRef?: (canvas: FabricJSCanvas | null) => void;\r\n    onPathCreated?: (path: Path) => void;\r\n    width?: number;\r\n    height?: number;\r\n    brushColor?: string;\r\n    brushWidth?: number;\r\n    showGrid?: boolean;\r\n}\r\n\r\n// ForwardRef so parent (Board) can call zoomIn/zoomOut\r\nconst Canvas = forwardRef(function Canvas(\r\n    {\r\n        isDrawingMode,\r\n        setCanvasRef,\r\n        onPathCreated,\r\n        width = 5000,\r\n        height = 3500,\r\n        brushColor = \"#000000\",\r\n        brushWidth = 3,\r\n        showGrid = true,\r\n    }: CanvasProps,\r\n    ref\r\n) {\r\n    const canvasElRef = useRef<HTMLCanvasElement | null>(null);\r\n    const fabricRef = useRef<FabricJSCanvas | null>(null);\r\n    const patternCacheRef = useRef<HTMLCanvasElement | null>(null);\r\n\r\n    // --- helper: apply zoom ---\r\n    const setZoom = (zoom: number, point?: { x: number; y: number }) => {\r\n        if (!fabricRef.current) return;\r\n        const canvas = fabricRef.current;\r\n        if (!point) {\r\n            point = { x: canvas.getWidth()! / 2, y: canvas.getHeight()! / 2 };\r\n        }\r\n        canvas.zoomToPoint(point, zoom);\r\n    };\r\n\r\n    // Expose zoom methods to parent\r\n    useImperativeHandle(ref, () => ({\r\n        zoomIn: () => {\r\n            if (fabricRef.current) {\r\n                const zoom = fabricRef.current.getZoom() * 1.1;\r\n                setZoom(Math.min(zoom, 4));\r\n            }\r\n        },\r\n        zoomOut: () => {\r\n            if (fabricRef.current) {\r\n                const zoom = fabricRef.current.getZoom() / 1.1;\r\n                setZoom(Math.max(zoom, 0.2));\r\n            }\r\n        },\r\n        resetZoom: () => {\r\n            if (fabricRef.current) {\r\n                setZoom(1);\r\n            }\r\n        },\r\n    }));\r\n\r\n    // Initialize Fabric canvas (once)\r\n    useEffect(() => {\r\n        if (!canvasElRef.current) return;\r\n\r\n        const fcanvas = new FabricJSCanvas(canvasElRef.current, {\r\n            isDrawingMode,\r\n            width,\r\n            height,\r\n            selection: false,\r\n            backgroundColor: \"#ffffff\",\r\n        });\r\n\r\n        fabricRef.current = fcanvas;\r\n\r\n        fcanvas.freeDrawingBrush = new PencilBrush(fcanvas);\r\n        fcanvas.freeDrawingBrush.width = brushWidth;\r\n        fcanvas.freeDrawingBrush.color = brushColor;\r\n\r\n        if (onPathCreated) {\r\n            fcanvas.on(\"path:created\", (opts: any) => {\r\n                const path = opts.path as Path | undefined;\r\n                if (path) onPathCreated(path);\r\n            });\r\n        }\r\n\r\n        // Make subtle dot grid\r\n        const makeGridPattern = () => {\r\n            const gridSize = 40;\r\n            const gridCanvas = document.createElement(\"canvas\");\r\n            gridCanvas.width = gridSize;\r\n            gridCanvas.height = gridSize;\r\n            const ctx = gridCanvas.getContext(\"2d\");\r\n            if (ctx) {\r\n                ctx.clearRect(0, 0, gridSize, gridSize);\r\n                ctx.fillStyle = \"rgba(0,0,0,0.06)\";\r\n                ctx.beginPath();\r\n                ctx.arc(gridSize / 2, gridSize / 2, 0.8, 0, Math.PI * 2);\r\n                ctx.fill();\r\n            }\r\n            return gridCanvas;\r\n        };\r\n        patternCacheRef.current = makeGridPattern();\r\n\r\n        if (showGrid && patternCacheRef.current) {\r\n            fcanvas.set(\"backgroundColor\", new Pattern({ source: patternCacheRef.current, repeat: \"repeat\" }));\r\n        }\r\n\r\n        if (setCanvasRef) setCanvasRef(fcanvas);\r\n\r\n        // --- Zoom with Ctrl + Scroll ---\r\n        const wheelHandler = (opt: WheelEvent) => {\r\n            if (!fabricRef.current) return;\r\n            if (!(opt.ctrlKey || opt.metaKey)) return; // only when holding ctrl/cmd\r\n            opt.preventDefault();\r\n\r\n            let zoom = fabricRef.current.getZoom();\r\n            zoom *= 0.999 ** opt.deltaY; // smooth zoom\r\n            zoom = Math.min(Math.max(zoom, 0.2), 4); // clamp\r\n            const point = { x: opt.offsetX, y: opt.offsetY };\r\n            setZoom(zoom, point);\r\n        };\r\n\r\n        canvasElRef.current?.addEventListener(\"wheel\", wheelHandler, { passive: false });\r\n\r\n        return () => {\r\n            fcanvas.dispose();\r\n            if (setCanvasRef) setCanvasRef(null);\r\n            canvasElRef.current?.removeEventListener(\"wheel\", wheelHandler);\r\n        };\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, []);\r\n\r\n    // update brush & mode dynamically\r\n    useEffect(() => {\r\n        if (fabricRef.current) fabricRef.current.isDrawingMode = isDrawingMode;\r\n    }, [isDrawingMode]);\r\n    useEffect(() => {\r\n        if (fabricRef.current?.freeDrawingBrush) fabricRef.current.freeDrawingBrush.color = brushColor;\r\n    }, [brushColor]);\r\n    useEffect(() => {\r\n        if (fabricRef.current?.freeDrawingBrush) fabricRef.current.freeDrawingBrush.width = brushWidth ?? 3;\r\n    }, [brushWidth]);\r\n    useEffect(() => {\r\n        if (!fabricRef.current) return;\r\n        if (showGrid && patternCacheRef.current) {\r\n            fabricRef.current.set(\"backgroundColor\", new Pattern({ source: patternCacheRef.current, repeat: \"repeat\" }));\r\n        } else {\r\n            fabricRef.current.set(\"backgroundColor\", \"#ffffff\");\r\n        }\r\n        fabricRef.current.renderAll();\r\n    }, [showGrid]);\r\n\r\n    return (\r\n        <div className=\"w-full h-full flex justify-center items-center overflow-auto p-6\">\r\n            <canvas\r\n                ref={canvasElRef}\r\n                width={width}\r\n                height={height}\r\n                className=\"block rounded-xl border border-gray-200 shadow-inner\"\r\n                aria-label=\"drawing-canvas\"\r\n            />\r\n        </div>\r\n    );\r\n});\r\n\r\nexport default Canvas;\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 282, "column": 0}, "map": {"version":3,"sources":["file:///C:/bridge/Bezalel/bezalel/src/app/board/%5BroomId%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\nimport io, { Socket } from \"socket.io-client\";\r\nimport Canvas from \"@/components/Canvas\";\r\nimport { Canvas as FabricJSCanvas, Object as FabricObject, Path as FabricPath } from \"fabric\";\r\nimport { toast } from \"sonner\";\r\nimport { Pencil, Hand, Undo2, Redo2, Sparkles, Monitor, Grid, ZoomIn, ZoomOut } from \"lucide-react\";\r\nimport PageSidebar from \"@/components/PageSidebar\";\r\nimport { v4 as uuid } from \"uuid\";\r\n\r\n\r\nexport default function Board() {\r\n    const { roomId } = useParams();\r\n    const canvasRef = useRef<FabricJSCanvas | null>(null);\r\n    const socketRef = useRef<Socket | null>(null);\r\n    const pcRef = useRef<RTCPeerConnection | null>(null);\r\n    const videoRef = useRef<HTMLVideoElement | null>(null);\r\n\r\n    // UI / drawing state\r\n    const [isStreaming, setIsStreaming] = useState(false);\r\n    const [viewerCount, setViewerCount] = useState(0);\r\n    const [aiPrompt, setAiPrompt] = useState(\"\");\r\n    const [isDrawingMode, setIsDrawingMode] = useState(true);\r\n    const [brushColor, setBrushColor] = useState(\"#000000\");\r\n    const [brushWidth, setBrushWidth] = useState(3);\r\n    const [viewUrl, setViewUrl] = useState(\"\"); // set only on client\r\n    const [showGrid, setShowGrid] = useState(true); // Figma-style grid toggle\r\n\r\n    const canvasComponentRef = useRef<any>(null);\r\n\r\n    // Undo / redo stacks (store Fabric objects)\r\n    const undoStack = useRef<FabricObject[]>([]);\r\n    const redoStack = useRef<FabricObject[]>([]);\r\n\r\n    // Pages state\r\n    const [pages, setPages] = useState<PageData[]>([\r\n        { id: uuid(), name: \"Page 1\", canvasData: null },\r\n    ]);\r\n    const [activePageId, setActivePageId] = useState(pages[0].id);\r\n\r\n    // --- Page management handlers ---\r\n    const handleAddPage = () => {\r\n        const newPage = { id: uuid(), name: `Page ${pages.length + 1}`, canvasData: null };\r\n        setPages((prev) => [...prev, newPage]);\r\n        setActivePageId(newPage.id);\r\n    };\r\n\r\n    const handleRenamePage = (id: string, newName: string) => {\r\n        setPages((prev) =>\r\n            prev.map((p) => (p.id === id ? { ...p, name: newName } : p))\r\n        );\r\n    };\r\n\r\n    const handleDeletePage = (id: string) => {\r\n        setPages((prev) => prev.filter((p) => p.id !== id));\r\n        if (activePageId === id && pages.length > 1) {\r\n            setActivePageId(pages.find((p) => p.id !== id)!.id);\r\n        }\r\n    };\r\n\r\n\r\n\r\n    // --- Safe window usage (SSR-safe) ---\r\n    useEffect(() => {\r\n        if (typeof window !== \"undefined\") {\r\n            setViewUrl(`${window.location.origin}/board/${roomId}/view`);\r\n        }\r\n    }, [roomId]);\r\n\r\n    // --- Socket.io setup ---\r\n    useEffect(() => {\r\n        const socket = io(process.env.NEXT_PUBLIC_SIGNALING_URL || \"http://localhost:3000\");\r\n        socketRef.current = socket;\r\n\r\n        socket.on(\"connect\", () => {\r\n            socket.emit(\"joinSession\", roomId);\r\n        });\r\n\r\n        socket.on(\"viewerCount\", (count: number) => {\r\n            setViewerCount(count);\r\n        });\r\n\r\n        return () => {\r\n            socket.disconnect();\r\n        };\r\n    }, [roomId]);\r\n\r\n    // --- WebRTC streaming (canvas + optional webcam) ---\r\n    useEffect(() => {\r\n        if (!isStreaming || !canvasRef.current || !videoRef.current) return;\r\n\r\n        const pc = new RTCPeerConnection({\r\n            iceServers: [{ urls: \"stun:stun.l.google.com:19302\" }],\r\n        });\r\n        pcRef.current = pc;\r\n\r\n        // get actual canvas element (some Fabric versions expose lowerCanvasEl)\r\n        const canvasElement =\r\n            // @ts-expect-error - try known properties\r\n            (canvasRef.current as any).lowerCanvasEl ?? (canvasRef.current as any).getElement?.();\r\n\r\n        if (!canvasElement || typeof canvasElement.captureStream !== \"function\") {\r\n            toast.error(\"Streaming not supported: unable to capture canvas stream.\");\r\n            return;\r\n        }\r\n\r\n        const canvasStream = canvasElement.captureStream(30);\r\n\r\n        navigator.mediaDevices\r\n            .getUserMedia({ video: true, audio: true })\r\n            .then((webcamStream) => {\r\n                const combined = new MediaStream();\r\n                canvasStream.getVideoTracks().forEach((t) => combined.addTrack(t));\r\n                webcamStream.getVideoTracks().forEach((t) => combined.addTrack(t));\r\n                webcamStream.getAudioTracks().forEach((t) => combined.addTrack(t));\r\n\r\n                combined.getTracks().forEach((t) => pc.addTrack(t, combined));\r\n                videoRef.current!.srcObject = combined;\r\n            })\r\n            .catch((err) => {\r\n                console.error(\"webcam error\", err);\r\n                toast.error(\"Could not access webcam — streaming canvas only.\");\r\n                canvasStream.getTracks().forEach((t) => pc.addTrack(t, canvasStream));\r\n            });\r\n\r\n        pc.onicecandidate = (ev) => {\r\n            if (ev.candidate) {\r\n                socketRef.current?.emit(\"ice-candidate\", { sessionId: roomId, candidate: ev.candidate });\r\n            }\r\n        };\r\n\r\n        socketRef.current?.on(\"answer\", async (answer: RTCSessionDescriptionInit) => {\r\n            await pc.setRemoteDescription(new RTCSessionDescription(answer));\r\n        });\r\n\r\n        socketRef.current?.on(\"ice-candidate\", async (candidate: RTCIceCandidateInit) => {\r\n            if (pcRef.current) {\r\n                await pcRef.current.addIceCandidate(new RTCIceCandidate(candidate));\r\n            }\r\n        });\r\n\r\n        pc.createOffer().then((offer) => {\r\n            pc.setLocalDescription(offer);\r\n            socketRef.current?.emit(\"offer\", { sessionId: roomId, offer });\r\n        });\r\n\r\n        return () => {\r\n            pc.close();\r\n            // ✅ Safe cleanup to avoid null crash\r\n            if (videoRef.current) {\r\n                videoRef.current.srcObject = null;\r\n            }\r\n        };\r\n    }, [isStreaming, roomId]);\r\n\r\n    // --- Path created (for undo stack) ---\r\n    const handlePathCreated = (path: FabricPath) => {\r\n        if (canvasRef.current && path) {\r\n            undoStack.current.push(path as unknown as FabricObject);\r\n            redoStack.current = [];\r\n        }\r\n    };\r\n\r\n    // Undo / Redo\r\n    const handleUndo = () => {\r\n        if (!canvasRef.current) return;\r\n        const last = undoStack.current.pop();\r\n        if (last) {\r\n            redoStack.current.push(last);\r\n            canvasRef.current.remove(last);\r\n            canvasRef.current.requestRenderAll?.();\r\n        }\r\n    };\r\n    const handleRedo = () => {\r\n        if (!canvasRef.current) return;\r\n        const last = redoStack.current.pop();\r\n        if (last) {\r\n            undoStack.current.push(last);\r\n            canvasRef.current.add(last);\r\n            canvasRef.current.requestRenderAll?.();\r\n        }\r\n    };\r\n\r\n    const handleEnhance = () => {\r\n        toast.info(\"AI enhancement not implemented yet.\");\r\n    };\r\n\r\n    const copyLink = () => {\r\n        if (!viewUrl) return;\r\n        navigator.clipboard.writeText(viewUrl);\r\n        toast.success(\"View link copied to clipboard!\");\r\n    };\r\n\r\n    return (\r\n        <div className=\"relative w-screen h-screen bg-neutral-100\">\r\n            {/* --- Header (slim Figma-style) --- */}\r\n            <header className=\"fixed top-0 left-0 right-0 h-14 z-40 flex items-center justify-between px-4 bg-white/80 backdrop-blur-md border-b border-gray-200\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <h1 className=\"text-sm font-semibold text-gray-800\">Bezalel Board</h1>\r\n                    <span className=\"text-xs text-gray-500\">/ {roomId}</span>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                        type=\"text\"\r\n                        value={viewUrl}\r\n                        readOnly\r\n                        className=\"text-xs text-gray-800 placeholder-gray-400 bg-gray-50 border border-gray-200 rounded-md px-2 py-1 w-64 focus:outline-none focus:ring-2 focus:ring-blue-400\"\r\n                        aria-label=\"view link\"\r\n                    />\r\n                    <button\r\n                        onClick={copyLink}\r\n                        className=\"inline-flex items-center gap-2 px-3 py-1 rounded-md bg-blue-600 text-white text-sm hover:bg-blue-700 transition\"\r\n                    >\r\n                        Copy\r\n                    </button>\r\n\r\n                    <div className=\"text-xs text-gray-600 px-2\">👀 {viewerCount} viewer{viewerCount === 1 ? \"\" : \"s\"}</div>\r\n                </div>\r\n            </header>\r\n\r\n            {/* --- Main area: occupies rest of viewport under header --- */}\r\n            <main className=\"absolute top-14 bottom-0 left-0 right-0 flex\">\r\n                \r\n\r\n                {/* Canvas pane (center) */}\r\n                <div className=\"flex-1 flex items-center justify-center overflow-auto\">\r\n                    <Canvas\r\n                        ref={canvasComponentRef}\r\n                        isDrawingMode={isDrawingMode}\r\n                        setCanvasRef={(c) => (canvasRef.current = c)}\r\n                        onPathCreated={handlePathCreated}\r\n                        width={5000}\r\n                        height={3500}\r\n                        brushColor={brushColor}\r\n                        brushWidth={brushWidth}\r\n                        showGrid={showGrid}\r\n                    />\r\n                </div>\r\n\r\n                {/* optional picture-in-picture preview */}\r\n                {isStreaming && (\r\n                    <aside className=\"w-64 p-3 border-l border-gray-100 bg-white/60\">\r\n                        <video ref={videoRef as any} autoPlay muted className=\"w-full h-40 rounded-md object-cover\" />\r\n                    </aside>\r\n                )}\r\n            </main>\r\n\r\n            {/* --- Floating toolbar (bottom center) Figma-style slim --- */}\r\n            <div className=\"fixed bottom-6 left-1/2 -translate-x-1/2 z-50\">\r\n                <div className=\"flex items-center gap-2 rounded-lg bg-white/95 backdrop-blur-md border border-gray-200 shadow-md px-2 py-2\">\r\n                    {/* Draw / Pan toggle */}\r\n                    <button\r\n                        title={isDrawingMode ? \"Drawing\" : \"Pan\"}\r\n                        onClick={() => setIsDrawingMode((s) => !s)}\r\n                        className={`p-2 rounded-md hover:bg-gray-100 transition ${isDrawingMode ? \"bg-gray-100\" : \"\"}`}\r\n                    >\r\n                        {isDrawingMode ? <Pencil className=\"w-4 h-4 text-gray-800\" /> : <Hand className=\"w-4 h-4 text-gray-800\" />}\r\n                    </button>\r\n\r\n                    {/* Color */}\r\n                    <input\r\n                        title=\"Brush color\"\r\n                        type=\"color\"\r\n                        value={brushColor}\r\n                        onChange={(e) => setBrushColor(e.target.value)}\r\n                        className=\"w-7 h-7 rounded-md border border-gray-200\"\r\n                    />\r\n\r\n                    {/* Width slider (compact) */}\r\n                    <input\r\n                        title=\"Brush size\"\r\n                        type=\"range\"\r\n                        min={1}\r\n                        max={40}\r\n                        value={brushWidth}\r\n                        onChange={(e) => setBrushWidth(Number(e.target.value))}\r\n                        className=\"w-24 accent-blue-500\"\r\n                    />\r\n\r\n                    <div className=\"w-px h-6 bg-gray-200 mx-2\" />\r\n\r\n                    {/* Undo / Redo controls */}\r\n                    <button title=\"Undo\" onClick={handleUndo} className=\"p-2 rounded-md hover:bg-gray-100\">\r\n                        <Undo2 className=\"w-4 h-4 text-gray-800\" />\r\n                    </button>\r\n                    <button title=\"Redo\" onClick={handleRedo} className=\"p-2 rounded-md hover:bg-gray-100\">\r\n                        <Redo2 className=\"w-4 h-4 text-gray-800\" />\r\n                    </button>\r\n\r\n                    <div className=\"w-px h-6 bg-gray-200 mx-2\" />\r\n\r\n                    {/* inside zoom in and out controls*/}\r\n                    <button\r\n                        title=\"Zoom Out\"\r\n                        onClick={() => canvasComponentRef.current?.zoomOut()}\r\n                        className=\"p-2 rounded-md hover:bg-gray-100\"\r\n                    >\r\n                        <ZoomOut className=\"w-4 h-4 text-gray-800\" />\r\n                    </button>\r\n                    <button\r\n                        title=\"Zoom In\"\r\n                        onClick={() => canvasComponentRef.current?.zoomIn()}\r\n                        className=\"p-2 rounded-md hover:bg-gray-100\"\r\n                    >\r\n                        <ZoomIn className=\"w-4 h-4 text-gray-800\" />\r\n                    </button>\r\n\r\n                    {/* AI prompt + enhance */}\r\n                    <input\r\n                        title=\"AI prompt\"\r\n                        placeholder=\"AI prompt\"\r\n                        value={aiPrompt}\r\n                        onChange={(e) => setAiPrompt(e.target.value)}\r\n                        className=\"text-xs text-gray-800 placeholder-gray-400 bg-gray-50 border border-gray-200 rounded-md px-2 py-1 w-44 focus:outline-none focus:ring-1 focus:ring-green-400\"\r\n                    />\r\n                    <button title=\"Enhance\" onClick={handleEnhance} className=\"p-2 rounded-md hover:bg-green-50\">\r\n                        <Sparkles className=\"w-4 h-4 text-green-600\" />\r\n                    </button>\r\n\r\n                    <div className=\"w-px h-6 bg-gray-200 mx-2\" />\r\n\r\n                    {/* Grid toggle (Figma-style) */}\r\n                    <button\r\n                        title=\"Toggle grid\"\r\n                        onClick={() => setShowGrid((s) => !s)}\r\n                        className={`p-2 rounded-md hover:bg-gray-100 transition ${showGrid ? \"bg-gray-100\" : \"\"}`}\r\n                    >\r\n                        <Grid className={`w-4 h-4 ${showGrid ? \"text-gray-800\" : \"text-gray-500\"}`} />\r\n                    </button>\r\n\r\n                    <div className=\"w-px h-6 bg-gray-200 mx-2\" />\r\n\r\n                    {/* Streaming toggle */}\r\n                    <label className=\"flex items-center gap-2 text-xs text-gray-700 cursor-pointer\">\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            checked={isStreaming}\r\n                            onChange={(e) => setIsStreaming(e.target.checked)}\r\n                            className=\"w-4 h-4 accent-blue-500\"\r\n                        />\r\n                        <Monitor className=\"w-4 h-4 text-gray-700\" />\r\n                    </label>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}